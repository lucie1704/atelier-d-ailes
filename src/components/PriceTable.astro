---
import type { PriceItem } from '~/types';

interface Props {
  title?: string;
  items?: PriceItem[];
}

const { title = "Titre tableau", items = [] } = Astro.props;

interface RowData {
  item: PriceItem;
  level: number;
}

const flattenItems = (items: PriceItem[], level: number = 0): RowData[] => {
  const result: RowData[] = [];

  for (const item of items) {
    result.push({ item, level });

    if (item.children) {
      result.push(...flattenItems(item.children, level + 1));
    }
  }

  return result;
};

const getPaddingClass = (level: number): string => {
  if (level === 0) return 'pl-4';
  if (level === 1) return 'pl-12';
  return 'pl-20';
};

const allRows = flattenItems(items);
---

<section class="max-w-4xl mx-auto my-16 px-4">
  <h2 class="text-2xl font-semibold mb-6 text-gray-900 dark:text-gray-100">
    {title}
  </h2>

  <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
      <thead class="bg-gray-100 dark:bg-gray-800">
      <tr>
        <th></th>
        <th class="text-left px-4 py-3 font-semibold text-gray-700 dark:text-gray-300">
          Prix
        </th>
      </tr>
      </thead>

      <tbody class="bg-white divide-y divide-gray-200 ">
      {allRows.map(({ item, level }) => {
        const paddingClass = getPaddingClass(level);
        const fontClass = level === 0 && item.children ? 'font-semibold' : '';

        return (
          <tr class="hover:bg-gray-50 transition-colors">
            <td class={`py-3 ${paddingClass} ${fontClass}`}>
              {item.title}
            </td>
            <td class="px-4 py-3">
              {item.price && (
                item.price === 'quote' ? (
                  <strong>Sur&nbsp;devis</strong>
                ) : (
                  `${item.price}\u00A0â‚¬`
                )
              )}
            </td>
          </tr>
        );
      })}
      </tbody>
    </table>
  </div>
</section>
